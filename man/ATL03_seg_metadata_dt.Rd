% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ATL03_seg_metadata_dt.R
\name{ATL03_seg_metadata_dt}
\alias{ATL03_seg_metadata_dt}
\title{ATL03 geolocation segment metadata}
\usage{
ATL03_seg_metadata_dt(
  atl03_h5,
  beam = c("gt1l", "gt1r", "gt2l", "gt2r", "gt3l", "gt3r"),
  attributes = c("h_ph", "altitude_sc", "bounce_time_offset", "delta_time",
    "full_sat_fract", "near_sat_fract", "neutat_delay_derivative", "neutat_delay_total",
    "neutat_ht", "ph_index_beg", "pitch", "podppd_flag", "range_bias_corr",
    "ref_azimuth", "ref_elev", "reference_photon_index", "roll", "segment_dist_x",
    "segment_id", "segment_length", "segment_ph_cnt", "sigma_across", "sigma_along",
    "sigma_h", "sigma_lat", "sigma_lon", "solar_azimuth", "solar_elevation", "surf_type",
    "tx_pulse_energy", "tx_pulse_skew_est", 
     "tx_pulse_width_lower",
    "tx_pulse_width_upper", "yaw")
)
}
\arguments{
\item{atl03_h5}{An ICESat-2 ATL03 object (output of \code{\link[=ATL03_read]{ATL03_read()}}),
i.e. an S4 object of class
\code{\link{icesat2.atl03_h5}}.}

\item{beam}{Character vector indicating beams to process
(e.g. \code{gt1l}, \code{gt1r}, \code{gt2l}, \code{gt2r}, \code{gt3l}, \code{gt3r}).
Only beams present in \code{atl03_h5$beams} are used.}

\item{attributes}{Character vector naming the segment-level variables to extract.
By default, a broad set of geolocation and quality variables is used,
including a derived reference-photon height (\code{h_ph}).}
}
\value{
A \code{\link[data.table:data.table]{data.table::data.table}} with one row per ATL03 geolocation segment,
with class \code{icesat2.atl03_seg_dt} prepended. Columns include:

\itemize{
\item \code{beam} - beam ID (e.g., \code{gt2l}).
\item \code{strong_beam} - logical flag indicating whether the beam is
classified as strong for the orbit.
\item selected geolocation fields (see below).
\item a derived \code{h_ph} column: height of the reference photon
for each segment (one value per segment).
}
}
\description{
Extract geolocation segment-level metadata from ICESat-2 ATL03 data.
Each row in the output corresponds to a single \strong{20m geolocation segment}
along track, not to individual photons.

In addition to variables from the ATL03 \code{geolocation} group, this
function derives a segment-level reference photon height (\code{h_ph}) using
the reference photon index and the photon-height array in the
\code{heights} group.
}
\details{
The following variables may be requested via `attributes``:
\itemize{
\item \code{h_ph}: Height of the \strong{reference photon} above the WGS84 ellipsoid
for each geolocation segment. This is derived from
\code{geolocation/ph_index_beg}, \code{geolocation/reference_photon_index},
and \code{heights/h_ph}.
\item \code{altitude_sc}: Height of the spacecraft above the WGS84 ellipsoid.
\item \code{beta_angle}: Acute angle between Sun vector and orbit
plane
\item \code{bounce_time_offset}: Difference between the transmit time and the
ground-bounce time of the reference photon.
\item \code{delta_time}: Transmit time of the reference photon, measured in
seconds from `atlas_sdp_gps_epoch``.
\item \code{full_sat_fract}: Fraction of pulses within the segment that are
fully saturated.
\item \code{near_sat_fract}: Fraction of pulses within the segment that are
nearly saturated.
\item \code{neutat_delay_derivative}: Change in neutral atmospheric delay per
unit height change.
\item \code{neutat_delay_total}: Total neutral atmosphere delay correction
(wet + dry).
\item \code{neutat_ht}: Reference height of the neutral atmosphere range
correction.
\item \code{ph_index_beg}: 1-based index of the first photon in this segment
within the photon-rate data.
\item \code{pitch}: Spacecraft pitch (degrees), 3-2-1 Euler sequence.
\item \code{podppd_flag}: Composite flag describing the quality of input
geolocation products for the segment.
\item \code{range_bias_corr}: Estimated range bias from geolocation analysis.
\item \code{ref_azimuth}: Azimuth (radians) of the unit pointing vector for the
reference photon in the local ENU frame.
\item \code{ref_elev}: Elevation (radians) of the unit pointing vector for the
reference photon in the local ENU frame.
\item \code{reference_photon_index}: Index of the reference photon within the
photon set for a segment.
\item \code{reference_photon_lat}: Latitude of the reference photon.
\item \code{reference_photon_lon}: Longitude of the reference photon.
\item \code{roll}: Spacecraft roll (degrees), 3-2-1 Euler sequence.
\item \code{segment_dist_x}: Along-track distance from the equator crossing to
the start of the 20 m geolocation segment.
\item \code{segment_id}: 7-digit along-track geolocation segment identifier.
\item \code{segment_length}: Along-track length of the geolocation segment
(typically 20 m).
\item \code{segment_ph_cnt}: Number of photons in the segment.
\item \code{sigma_across}: Estimated Cartesian across-track uncertainty
(1-sigma) for the reference photon.
\item \code{sigma_along}: Estimated Cartesian along-track uncertainty (1-sigma)
for the reference photon.
\item \code{sigma_h}: Estimated height uncertainty (1-sigma) for the reference
photon bounce point.
\item \code{sigma_lat}: Estimated geodetic latitude uncertainty (1-sigma) for
the reference photon.
\item \code{sigma_lon}: Estimated geodetic longitude uncertainty (1-sigma) for
the reference photon.
\item \code{solar_azimuth}: Azimuth (degrees east) of the sun position vector
from the reference photon bounce point in the local ENU frame.
\item \code{solar_elevation}: Elevation (degrees) of the sun position vector
from the reference photon bounce point in the local ENU frame.
\item \code{surf_type}: Flags describing which surface types the segment is
associated with (land, ocean, sea ice, land ice, inland water).
\item \code{tx_pulse_energy}: Average transmit pulse energy per beam.
\item \code{tx_pulse_skew_est}: Difference between the averages of the lower and
upper threshold crossing times, estimating transmit pulse skew.
\item \code{tx_pulse_width_lower}: Average distance between lower threshold
crossing times measured by the Start Pulse Detector.
\item \code{tx_pulse_width_upper}: Average distance between upper threshold
crossing times measured by the Start Pulse Detector.
\item \code{velocity_sc}: Spacecraft velocity components (east
component, north component, up component)
an observer on the ground would measure.
While values are common to all beams, this
parameter is naturally produced as part of
geolocation.
\item \code{yaw}: Spacecraft yaw (degrees), 3-2-1 Euler sequence.
}
}
\examples{
atl03_path <- system.file(
  "extdata", "atl03_clip.h5",
  package = "ICESat2VegR"
)

atl03_h5 <- ATL03_read(atl03_path)

# Extract ATL03 geolocation segment metadata
atl03_segment_dt <- ATL03_seg_metadata_dt(atl03_h5)

head(atl03_segment_dt)
close(atl03_h5)

}
\seealso{
\url{https://icesat-2.gsfc.nasa.gov/sites/default/files/page_files/ICESat2_ATL03_ATBD_r006.pdf}
}
