% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ATL08_h5_clipBox.R, R/ATL08_h5_clipGeometry.R
\name{ATL08_h5_clipGeometry}
\alias{ATL08_h5_clipGeometry}
\title{Clips ICESat-2 ATL08 data}
\usage{
ATL08_h5_clipGeometry(
  ATL08,
  output,
  vect,
  split_by = NULL,
  beam = c("gt1r", "gt2r", "gt3r", "gt1l", "gt2l", "gt3l"),
  additional_groups = c("orbit_info")
)

ATL08_h5_clipGeometry(
  ATL08,
  output,
  vect,
  split_by = NULL,
  beam = c("gt1r", "gt2r", "gt3r", "gt1l", "gt2l", "gt3l"),
  additional_groups = c("orbit_info")
)
}
\arguments{
\item{ATL08}{An \code{\linkS4class{icesat2.ATL08_h5}} object obtained via
\code{\link[=ATL08_read]{ATL08_read()}}, representing the ATL08 HDF5 file to be clipped.}

\item{output}{Character string defining the base output filepath. The final
output files will be named using:
\code{paste0(output, "_", <split_by_value>, ".h5")}.}

\item{vect}{A \code{\link[terra:SpatVector-class]{terra::SpatVector}} containing the polygon or multipolygon
geometries used as clipping regions. Each feature corresponds to one
clipping output.}

\item{split_by}{Character. Name of the attribute column in \code{vect} used
to uniquely identify each clipping region and to suffix output filenames.
Defaults to \code{"id"}.}

\item{beam}{Character vector specifying which ATL08 beams to include.
Defaults to:
\code{c("gt1l", "gt2l", "gt3l", "gt1r", "gt2r", "gt3r")}.}

\item{additional_groups}{Character vector of additional non-beam groups to
be copied unchanged into each output file. The default is:
\code{c("orbit_info")}.}

\item{atl08}{\code{\linkS4class{icesat2.atl08_h5}} object, obtained through \code{\link[=ATL08_read]{ATL08_read()}}
for clipping}
}
\value{
Returns a list of clipped S4 object of class \code{\linkS4class{icesat2.atl08_h5}}

A list of clipped S4 objects of class
\code{\linkS4class{icesat2.ATL08_h5}}, one for each geometry in
\code{vect}.
}
\description{
This function clips ATL08 HDF5 file within beam groups,
but keeps metada and ancillary data the same.

Clips an ICESat-2 ATL08 HDF5 file using one or more geometry-based clipping
regions provided as a \code{\link[terra:SpatVector-class]{terra::SpatVector}}. Each feature (row) in
\code{vect} defines a separate clipping boundary. For every geometry, a new
clipped ATL08 HDF5 file is created with the beam-level datasets spatially
filtered to include only segments within the clipping region.

The resulting output filenames are automatically suffixed with the value of
the attribute specified in \code{split_by}, enabling batch generation of
multiple clipped ATL08 files from a single input.

Metadata, ancillary groups, and orbit information are preserved unchanged in
every output file.
}
\details{
Only the beam-level groups (e.g., \code{gt1l}, \code{gt2r}, …) are spatially
filtered. All metadata, orbit information, and ancillary ATL08 groups are
preserved without modification.

The function:
\enumerate{
\item Computes polygon-based masks for each beam–segment pair.
\item Removes all ATL08 segment datasets outside the clipping geometry.
\item Writes each clipped subset into its own ATL08 HDF5 file.
\item Returns the loaded results as S4 objects.
}

This is the geometry-based companion to bounding-box clipping functions in
the package.
}
\examples{
# ATL08 file path
atl08_path <- system.file("extdata",
  "atl08_clip.h5",
  package = "ICESat2VegR"
)

# Reading ATL08 data (h5 file)
atl08_h5 <- ATL08_read(atl08_path = atl08_path)

output <- tempfile(fileext = ".h5")

vect_path <- system.file("extdata",
  "clip_geom.shp",
  package = "ICESat2VegR"
)

vect <- terra::vect(vect_path)

# Clipping ATL08 photons by boundary box extent
atl08_photons_dt_clip <- ATL08_h5_clipGeometry(
  atl08_h5,
  output,
  vect,
  split_by = "id"
)

close(atl08_h5)
# ATL08 file path
ATL08_path <- system.file("extdata",
  "ATL08_clip.h5",
  package = "ICESat2VegR"
)

# Read ATL08 file
ATL08_h5 <- ATL08_read(ATL08_path)

# Base output name (actual filenames will append split_by values)
output <- tempfile(fileext = ".h5")

# Load clipping polygons
vect_path <- system.file("extdata", "clip_objs.shp",
  package = "ICESat2VegR"
)
vect <- terra::vect(vect_path)

# Clip ATL08 using polygon geometries
ATL08_clipped_list <- ATL08_h5_clipGeometry(
  ATL08_h5,
  output,
  vect,
  split_by = "id"
)

close(ATL08_h5)

}
